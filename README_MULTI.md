# 抖音弹幕实时监控 - 多直播间并发版

## 🎯 新功能

✅ **同时监控多个直播间** - 支持添加多个直播间并发监控
✅ **独立控制** - 每个直播间可以独立启动/停止
✅ **批量操作** - 一键启动/停止所有直播间
✅ **房间标识** - 每条弹幕显示来源直播间
✅ **统一过滤** - 所有直播间共享正则表达式过滤器
✅ **实时统计** - 显示总直播间数、运行中数量、弹幕总数

---

## 🚀 快速启动

### 方法 1：使用启动脚本

```bash
./run_multi.sh
```

### 方法 2：直接启动

```bash
python3 web_server_multi.py
```

然后在浏览器中打开：**http://localhost:8080**

---

## 📖 使用说明

### 1. 添加直播间

1. 在"添加直播间 ID"输入框输入 web_rid（例如：`4253196531`）
2. （可选）设置正则表达式过滤
3. 点击"添加直播间"按钮
4. 直播间会出现在左侧列表中

### 2. 启动监控

**单个启动：**
- 点击直播间卡片上的"启动"按钮

**批量启动：**
- 点击顶部的"启动全部"按钮

### 3. 查看弹幕

- 右侧会实时显示所有直播间的弹幕
- 每条弹幕带有来源直播间标识
- 点击"复制"按钮可复制弹幕内容

### 4. 停止监控

**单个停止：**
- 点击直播间卡片上的"停止"按钮

**批量停止：**
- 点击顶部的"停止全部"按钮

### 5. 移除直播间

- 点击直播间卡片上的"移除"按钮
- 确认后即可移除

---

## 🎨 界面布局

```
┌─────────────────────────────────────────────────────────┐
│  🎬 抖音弹幕实时监控 - 多直播间并发版                      │
│                                                         │
│  [添加直播间 ID] [正则过滤] [添加] [启动全部] [停止全部]  │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  直播间: 3  │  运行中: 2  │  过滤: 礼物  │  弹幕: 156    │
└─────────────────────────────────────────────────────────┘

┌──────────────┬──────────────────────────────────────────┐
│ 📺 直播间列表 │  💬 实时弹幕 (所有直播间)                 │
│              │                                          │
│ ┌──────────┐ │  ┌────────────────────────────────────┐ │
│ │ 直播间 1  │ │  │ [直播间1] 歪比巴卜          [复制] │ │
│ │ 👤 主播A  │ │  │ 02:56:30                           │ │
│ │ [停止][移除]│ │  └────────────────────────────────────┘ │
│ └──────────┘ │                                          │
│              │  ┌────────────────────────────────────┐ │
│ ┌──────────┐ │  │ [直播间2] 送了礼物          [复制] │ │
│ │ 直播间 2  │ │  │ 02:56:25                           │ │
│ │ 👤 主播B  │ │  └────────────────────────────────────┘ │
│ │ [启动][移除]│ │                                          │
│ └──────────┘ │                                          │
└──────────────┴──────────────────────────────────────────┘
```

---

## 🔧 API 接口

### GET /api/rooms
获取所有直播间列表

### POST /api/add_room
添加一个直播间
```json
{
    "web_rid": "4253196531"
}
```

### POST /api/start_room/<room_id>
启动指定直播间

### POST /api/stop_room/<room_id>
停止指定直播间

### POST /api/remove_room/<room_id>
移除指定直播间

### POST /api/start_all
启动所有直播间

### POST /api/stop_all
停止所有直播间

### POST /api/filter
设置正则表达式过滤器
```json
{
    "pattern": "礼物|关注"
}
```

### GET /api/history
获取历史弹幕
- 参数：`count` - 数量（默认20）
- 参数：`room_id` - 指定房间（可选）

### GET /api/status
获取运行状态

---

## 💡 使用场景

### 场景 1：监控多个游戏主播

```
添加直播间：
1. 主播A - 王者荣耀
2. 主播B - 和平精英
3. 主播C - 原神

过滤规则：王者荣耀【[^】]+】.*?今天(9[0-9]{2}|[1-9]\d{3,})块

结果：只显示所有直播间中价格≥900的王者口令
```

### 场景 2：监控多个带货直播间

```
添加直播间：
1. 美妆直播间
2. 服装直播间
3. 数码直播间

过滤规则：优惠|折扣|秒杀|链接

结果：只显示包含促销信息的弹幕
```

### 场景 3：监控多个热门直播间

```
添加直播间：
1. 热门直播间1
2. 热门直播间2
3. 热门直播间3

过滤规则：留空

结果：显示所有直播间的所有弹幕
```

---

## 🎯 高级功能

### 1. 独立房间缓冲区

每个直播间有独立的弹幕缓冲区（100条），同时有全局缓冲区（200条）。

### 2. 自动重连

如果某个直播间断开连接，会自动尝试重连。

### 3. 线程安全

每个直播间在独立的线程中运行，互不影响。

### 4. 实时统计

- 总直播间数
- 运行中的直播间数
- 总弹幕数
- 当前过滤规则

---

## 📊 性能说明

### 资源占用

- **单个直播间**：约 10-20 MB 内存
- **5个直播间**：约 50-100 MB 内存
- **CPU占用**：每个直播间约 1-2%

### 推荐配置

- **最多同时监控**：10个直播间
- **弹幕显示数量**：50条（可调整）
- **缓冲区大小**：每个房间100条，全局200条

---

## 🔄 与单直播间版本对比

| 功能 | 单直播间版 | 多直播间版 |
|------|-----------|-----------|
| 同时监控数量 | 1个 | 多个 |
| 独立控制 | ❌ | ✅ |
| 批量操作 | ❌ | ✅ |
| 房间标识 | ❌ | ✅ |
| 资源占用 | 低 | 中等 |
| 适用场景 | 单个直播间 | 多个直播间 |

---

## 🐛 常见问题

### Q: 最多可以添加多少个直播间？

**A:** 理论上无限制，但建议不超过10个，以保证性能。

### Q: 如何只看某个直播间的弹幕？

**A:** 目前显示所有直播间的弹幕，可以通过房间标识区分。未来版本会添加筛选功能。

### Q: 过滤规则对所有直播间生效吗？

**A:** 是的，过滤规则是全局的，对所有直播间生效。

### Q: 可以为不同直播间设置不同的过滤规则吗？

**A:** 当前版本不支持，未来版本会添加此功能。

---

## 📁 文件说明

```
DouyinDm/
├── web_server_multi.py        # 多直播间后端服务器 ⭐⭐⭐
├── templates/
│   ├── index.html             # 单直播间前端
│   └── index_multi.html       # 多直播间前端 ⭐⭐⭐
├── run_multi.sh               # 多直播间启动脚本 ⭐
└── README_MULTI.md            # 本文档
```

---

## 🚀 快速开始

```bash
# 1. 启动服务器
./run_multi.sh

# 2. 打开浏览器
# 访问 http://localhost:8080

# 3. 添加直播间
# 输入 web_rid: 4253196531
# 点击"添加直播间"

# 4. 启动监控
# 点击"启动"或"启动全部"

# 5. 查看弹幕
# 右侧实时显示所有弹幕
```

---

**祝你使用愉快！** 🎉
